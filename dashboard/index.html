<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI NIDS Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:ital,wght@0,300;0,400;0,500;0,600;0,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <!-- Skip link for accessibility -->
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <!-- Theme toggle & Toast container -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- Header -->
  <header class="app-header" id="appHeader">
    <div class="header-content">
      <div class="brand">
        <div class="logo" role="img" aria-label="Shield icon">üõ°Ô∏è</div>
        <div class="brand-text">
          <h1>AI Network IDS</h1>
          <p class="subtitle">Machine learning powered Network Intrusion Detection System</p>
        </div>
      </div>
      <div class="header-status">
        <div class="theme-toggle" id="themeToggle" title="Toggle dark/light mode" role="button" tabindex="0"></div>
        <div class="status-indicator" id="apiStatus" role="status" aria-live="polite">
          <span class="status-text">Connecting‚Ä¶</span>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-layout" id="main-content">
    <!-- Sidebar Navigation -->
    <aside class="sidebar" role="complementary">
      <!-- Model Initialization -->
      <section class="card">
        <div class="card-header">
          <h2 class="card-title">
            <span class="card-title-icon" role="img" aria-label="Robot icon">ü§ñ</span>
            Model Management
          </h2>
        </div>
        <div class="card-content">
          <!-- Dataset Selector -->
          <div class="field">
            <label for="datasetSelect" class="field-label">Dataset</label>
            <select id="datasetSelect" class="field-select" aria-label="Select dataset">
              <option value="unsw">UNSW</option>
            </select>
          </div>
          <!-- Secondary Model Selector (synchronized with header selector) -->
          <div class="field">
            <label for="modelSelectSecondary" class="field-label">Model</label>
            <select id="modelSelectSecondary" class="field-select" aria-label="Select model">
              <option value="">Auto (dataset default)</option>
            </select>
          </div>
          <div class="field">
            <button id="loadModelsBtn" class="btn btn-primary">
              <span role="img" aria-label="Load icon">‚ö°</span>
              Initialize & Load Models
            </button>
          </div>
          <div class="text-sm text-muted" id="modelStatus" role="status">Ready to load models...</div>
          <div class="text-sm text-muted" id="featureCount" role="status" style="margin-top: var(--space-2);">‚Äî</div>
        </div>
      </section>

      <!-- Presets -->
      <section class="card">
        <div class="card-header">
          <h2 class="card-title">
            <span class="card-title-icon" role="img" aria-label="Template icon">üéØ</span>
            Quick Presets
          </h2>
        </div>
        <div class="card-content">
          <div class="chip-group">
            <button id="presetRandom" class="chip">
              <span role="img" aria-label="Dice icon">üé≤</span>
              Random Sample
            </button>
          </div>
          <div id="presetThreats" class="chip-group" style="margin-top: var(--space-4);"></div>
        </div>
      </section>

      <!-- Actions -->
      <section class="card">
        <div class="card-header">
          <h2 class="card-title">
            <span class="card-title-icon" role="img" aria-label="Action icon">‚ö°</span>
            Actions
          </h2>
        </div>
        <div class="card-content">
          <div class="flex flex-col gap-3">
            <button id="predictBtn" class="btn btn-primary" disabled>
              <span role="img" aria-label="Predict icon">üîÆ</span>
              Predict
            </button>
            <button id="clearBtn" class="btn" disabled>
              <span role="img" aria-label="Clear icon">üóëÔ∏è</span>
              Clear Form
            </button>
          </div>
        </div>
      </section>

      <!-- Feedback -->
      <section class="card">
        <div class="card-header">
          <h2 class="card-title">
            <span class="card-title-icon" role="img" aria-label="Feedback icon">üí¨</span>
            Model Feedback
          </h2>
        </div>
        <div class="card-content">
          <div class="field">
            <label for="feedbackLabel" class="field-label">Feedback Type</label>
            <select id="feedbackLabel" class="field-select">
              <option value="correct">‚úÖ Correct</option>
              <option value="false_positive">‚ö†Ô∏è False Positive</option>
              <option value="false_negative">‚ùå False Negative</option>
            </select>
          </div>
          <button id="sendFeedback" class="btn btn-success" disabled>
            <span role="img" aria-label="Send icon">üì§</span>
            Send Feedback
          </button>
          <div class="text-sm text-muted" id="feedbackStatus" role="status" style="margin-top: var(--space-2);">‚Äî</div>
        </div>
      </section>
    </aside>

    <!-- Main Content Area -->
    <section class="content-area" role="main">
      <!-- Feature Input Form (condensed) -->
      <div class="card card-features-condensed">
        <div class="card-header">
          <h2 class="card-title">
            <span class="card-title-icon" role="img" aria-label="Input icon">‚öôÔ∏è</span>
            Feature Inputs
          </h2>
        </div>
        <div class="card-content features-form-wrapper">
          <div id="featuresForm" class="grid grid-features-compact"></div>
        </div>
      </div>

      <!-- Charts Section -->
      <div class="charts-section">
        <div class="charts-grid">
          <!-- Main Prediction Display -->
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">
                <span class="card-title-icon" role="img" aria-label="Crystal ball icon">üîÆ</span>
                Prediction Results
              </h2>
            </div>
            <div class="card-content">
              <div class="prediction-grid">
                <div class="prediction-row">
                  <span class="prediction-label">Predicted Class:</span>
                  <span id="predClass" class="prediction-value">‚Äî</span>
                </div>
                <div class="prediction-row">
                  <span class="prediction-label">Threat Type:</span>
                  <span id="predThreat" class="prediction-value">‚Äî</span>
                </div>
                <div class="prediction-row">
                  <span class="prediction-label">Confidence:</span>
                  <span id="predConfidence" class="prediction-value">‚Äî</span>
                </div>
                <div class="prediction-row">
                  <span class="prediction-label">Attack Detected:</span>
                  <span id="predAttack" class="prediction-value">‚Äî</span>
                </div>
                <div class="prediction-row">
                  <span class="prediction-label">Model Type:</span>
                  <span id="predModel" class="prediction-value">‚Äî</span>
                </div>
              </div>
              <div id="predError" class="text-sm" style="color: var(--color-danger); margin-top: var(--space-3);"></div>
              
              <!-- Probability Display -->
              <div class="probabilities-section">
                <h3 class="probabilities-title">Prediction Confidence Distribution</h3>
                <div id="topProbs" class="probability-list"></div>
              </div>
            </div>
          </div>

          <!-- Model Explanation -->
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">
                <span class="card-title-icon" role="img" aria-label="Explain icon">üß†</span>
                Model Explainability
              </h2>
            </div>
            <div class="card-content">
              <div class="btn-group">
                <button id="explainShap" class="btn">SHAP Analysis</button>
                <button id="explainLime" class="btn">LIME Local</button>
                <button id="incUpdate" class="btn">Update Model</button>
              </div>
              <div class="explanation-status" id="incStatus">‚Äî</div>
              <div class="explanation-container">
                <div id="explanationOut" class="explanation-output">‚Äî</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Investigation Panel -->
      <div class="investigation-panel">
        <!-- Labels Section -->
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">
              <span class="card-title-icon" role="img" aria-label="Tag icon">üè∑Ô∏è</span>
              Available Labels
            </h2>
          </div>
          <div class="card-content">
            <div id="labels" class="labels-container"></div>
          </div>
        </div>

        <!-- Available Models -->
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">
              <span class="card-title-icon" role="img" aria-label="Models icon">ü§ñ</span>
              Trained ML Models
            </h2>
          </div>
          <div class="card-content">
            <div id="allModels" class="all-models-grid"></div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Slide-over Panel for detailed views -->
  <div class="modal-overlay" id="slideOverlay">
    <div class="slide-panel" id="slidePanel">
      <div class="slide-panel-header">
        <h3 class="slide-panel-title" id="slidePanelTitle">Alert Details</h3>
        <button class="slide-panel-close" id="slidePanelClose" aria-label="Close panel">
          <span role="img" aria-label="Close icon">‚úñÔ∏è</span>
        </button>
      </div>
      <div class="slide-panel-tabs">
        <button class="slide-panel-tab active" data-tab="overview">Overview</button>
        <button class="slide-panel-tab" data-tab="features">Features</button>
        <button class="slide-panel-tab" data-tab="correlation">Correlation</button>
        <button class="slide-panel-tab" data-tab="raw">Raw Data</button>
      </div>
      <div class="slide-panel-content" id="slidePanelContent">
        <!-- Content will be dynamically loaded -->
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="app-footer">
    <div>¬© 2025 AI NIDS ‚Ä¢ Enhanced Dashboard v4.0</div>
    <div class="text-muted">Machine Learning Powered Network Security</div>
  </footer>

  <script src="script.js"></script>
</body>
</html>